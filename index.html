<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìœˆë„ìš° ì—°ë™ ì•„ì¹¨ë…ì„œ ë„ì„œ ì •ë³´ ì¶”ì¶œê¸° v3.0</title>
  <style>
    /* CSS ë³€ìˆ˜ë¡œ í…Œë§ˆ ê´€ë¦¬ */
    :root {
      --primary-color: #007bff;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
      --gray-600: #6c757d;
      --gray-100: #f8f9fa;
      --white: #ffffff;
      --shadow: 0 2px 4px rgba(0,0,0,0.1);
      --shadow-hover: 0 4px 8px rgba(0,0,0,0.1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      background-color: var(--gray-100);
    }

    /* í—¤ë” ìŠ¤íƒ€ì¼ */
    header {
      text-align: center;
      margin-bottom: 30px;
      background-color: var(--white);
      padding: 30px;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }

    h1 {
      color: #333;
      margin-bottom: 20px;
    }

    /* ì…ë ¥ ì˜ì—­ */
    .input-group {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    #url-input {
      padding: 12px 16px;
      font-size: 1em;
      border: 2px solid #ddd;
      border-radius: 6px;
      width: 100%;
      max-width: 500px;
      transition: border-color 0.3s;
    }

    #url-input:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    button {
      padding: 12px 24px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background-color: #0056b3;
    }

    .btn-secondary {
      background-color: var(--gray-600);
      color: white;
    }

    .btn-success {
      background-color: var(--success-color);
      color: white;
    }

    .btn-warning {
      background-color: var(--warning-color);
      color: #333;
    }

    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* ë©”ì‹œì§€ ì˜ì—­ */
    #message-area {
      text-align: center;
      margin-top: 15px;
      padding: 12px;
      border-radius: 6px;
      min-height: 1.5em;
      transition: all 0.3s ease;
    }

    .message-error {
      color: #721c24;
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
    }

    .message-info {
      color: #004085;
      background-color: #cce5ff;
      border: 1px solid #b8daff;
    }

    .message-success {
      color: #155724;
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
    }

    /* ìœˆë„ìš° ì—°ë™ ì˜ì—­ */
    .windows-integration {
      background-color: var(--white);
      padding: 20px;
      border-radius: 8px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border-left: 4px solid var(--primary-color);
    }

    .windows-integration h3 {
      margin-top: 0;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .integration-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .integration-card {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #dee2e6;
    }

    .integration-card h4 {
      margin-top: 0;
      color: var(--primary-color);
      font-size: 1em;
    }

    .integration-card p {
      margin: 10px 0;
      font-size: 0.9em;
      color: var(--gray-600);
    }

    /* í†µê³„ ì˜ì—­ */
    .stats-container {
      background-color: var(--white);
      padding: 20px;
      border-radius: 8px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      display: none;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: var(--primary-color);
    }

    .stat-label {
      color: var(--gray-600);
      font-size: 0.9em;
    }

    /* ë„ì„œ ëª©ë¡ ì»¨í…Œì´ë„ˆ */
    #book-list {
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    /* ë„ì„œ ì¹´ë“œ */
    .book {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      background-color: var(--white);
      padding: 20px;
      border-radius: 8px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      position: relative;
    }

    .book:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    .book-number {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: var(--gray-600);
      color: white;
      font-size: 0.8em;
      padding: 2px 8px;
      border-radius: 4px;
    }

    .cover {
      width: 100px;
      height: auto;
      max-height: 150px;
      border: 1px solid #eee;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .info {
      flex: 1;
    }

    .category {
      font-size: 0.85em;
      color: var(--gray-600);
      margin-bottom: 8px;
      background-color: #e9ecef;
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
    }

    .title {
      font-size: 1.1em;
      font-weight: bold;
      margin: 0 0 10px 0;
      color: #343a40;
      word-break: keep-all;
      line-height: 1.4;
    }

    .title a {
      text-decoration: none;
      color: inherit;
    }

    .title a:hover {
      text-decoration: underline;
      color: var(--primary-color);
    }

    /* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
    .actions {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .actions button {
      padding: 8px 16px;
      font-size: 0.9em;
      cursor: pointer;
      color: white;
      border: none;
      border-radius: 4px;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 100px;
    }

    .download-btn {
      background-color: var(--success-color);
    }

    .copy-title-btn {
      background-color: var(--info-color);
    }

    .copy-url-btn {
      background-color: var(--warning-color);
      color: #333;
    }

    /* ì¼ê´„ ì‘ì—… ì˜ì—­ */
    .bulk-actions {
      background-color: var(--white);
      padding: 20px;
      border-radius: 8px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      display: none;
    }

    .bulk-actions h3 {
      margin-top: 0;
      color: #333;
    }

    .bulk-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* í…ìŠ¤íŠ¸ ì˜ì—­ */
    .script-output {
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* ì§„í–‰ë¥  í‘œì‹œ */
    .progress-container {
      margin-top: 15px;
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background-color: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background-color: var(--primary-color);
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.8em;
    }

    /* ì•ˆë‚´ ë¬¸êµ¬ */
    .notice {
      margin-top: 30px;
      text-align: center;
      font-size: 0.9em;
      color: var(--gray-600);
      padding: 20px;
      background-color: var(--white);
      border-radius: 8px;
      box-shadow: var(--shadow);
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .loader {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      #book-list {
        grid-template-columns: 1fr;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      #url-input {
        width: 100%;
      }
      
      .bulk-buttons {
        flex-direction: column;
      }
      
      .bulk-buttons button {
        width: 100%;
      }

      .integration-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸªŸ ìœˆë„ìš° ì—°ë™ ì•„ì¹¨ë…ì„œ ë„ì„œ ì •ë³´ ì¶”ì¶œê¸° v3.0</h1>
    <div class="input-group">
      <input id="url-input" type="url" placeholder="ì•„ì¹¨ë…ì„œ ì†Œê°œ í˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”" />
      <div class="button-group">
        <button id="fetch-btn" class="btn-primary">ğŸ” ì¶”ì¶œ ì‹œì‘</button>
        <button id="clear-btn" class="btn-secondary">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
      </div>
    </div>
    <div id="message-area"></div>
    <div class="loader" id="loader"></div>
  </header>

  <!-- ìœˆë„ìš° ì—°ë™ ì•ˆë‚´ -->
  <section class="windows-integration">
    <h3>ğŸªŸ ìœˆë„ìš° ê¸°ë³¸ ì•± ì—°ë™ ì†”ë£¨ì…˜</h3>
    <div class="integration-grid">
      <div class="integration-card">
        <h4>ğŸ–¼ï¸ ìœˆë„ìš° ì‚¬ì§„ ì•±</h4>
        <p>ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•œ í›„ ì‚¬ì§„ ì•±ì—ì„œ ìë™ìœ¼ë¡œ JPG/PNG ë³€í™˜</p>
        <button id="photo-app-guide" class="btn-primary" style="width: 100%;">ğŸ“– ì‚¬ìš©ë²• ë³´ê¸°</button>
      </div>
      <div class="integration-card">
        <h4>ğŸ“ PowerShell ìŠ¤í¬ë¦½íŠ¸</h4>
        <p>ì¼ê´„ ì´ë¯¸ì§€ ë³€í™˜ ë° ì •ë¦¬ë¥¼ ìœ„í•œ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</p>
        <button id="generate-powershell" class="btn-success" style="width: 100%;">âš¡ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</button>
      </div>
      <div class="integration-card">
        <h4>ğŸ“¥ ë‹¤ìš´ë¡œë“œ ë§¤ë‹ˆì €</h4>
        <p>IDM, FDM ë“± ë‹¤ìš´ë¡œë“œ ë§¤ë‹ˆì €ìš© URL ë¦¬ìŠ¤íŠ¸ ì œê³µ</p>
        <button id="generate-url-list" class="btn-warning" style="width: 100%;">ğŸ”— URL ë¦¬ìŠ¤íŠ¸</button>
      </div>
    </div>
  </section>

  <!-- í†µê³„ ì •ë³´ -->
  <section class="stats-container" id="stats-container">
    <h2>ğŸ“Š ì¶”ì¶œ ê²°ê³¼ í†µê³„</h2>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value" id="total-books">0</div>
        <div class="stat-label">ì „ì²´ ë„ì„œ</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="unique-categories">0</div>
        <div class="stat-label">ë¶„ë¥˜ ìˆ˜</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="download-ready">0</div>
        <div class="stat-label">ë‹¤ìš´ë¡œë“œ ì¤€ë¹„</div>
      </div>
    </div>
  </section>

  <!-- ì¼ê´„ ì‘ì—… ì˜ì—­ -->
  <section class="bulk-actions" id="bulk-actions">
    <h3>ğŸ“‹ ì¼ê´„ ì‘ì—…</h3>
    <div class="bulk-buttons">
      <button id="copy-all-titles" class="btn-primary">ğŸ“ ì „ì²´ ì œëª© ë³µì‚¬</button>
      <button id="export-csv" class="btn-primary">ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°</button>
      <button id="export-json" class="btn-primary">ğŸ’¾ JSON ë‚´ë³´ë‚´ê¸°</button>
      <button id="download-all-original" class="btn-success">ğŸ“¥ ì›ë³¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
      <button id="create-batch-script" class="btn-warning">ğŸ”§ ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</button>
    </div>
    <div class="progress-container" id="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill">0%</div>
      </div>
    </div>
  </section>

  <!-- ë„ì„œ ëª©ë¡ -->
  <section id="book-list"></section>

  <!-- ìŠ¤í¬ë¦½íŠ¸ ì¶œë ¥ ì˜ì—­ -->
  <section id="script-section" style="display: none;">
    <h3>ğŸ“œ ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸</h3>
    <div class="script-output" id="script-output"></div>
    <button id="copy-script" class="btn-primary" style="margin-top: 10px;">ğŸ“‹ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬</button>
    <button id="download-script" class="btn-success" style="margin-top: 10px;">ğŸ“¥ íŒŒì¼ë¡œ ì €ì¥</button>
  </section>

  <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
  <footer class="notice">
    <p>
      <strong>ğŸªŸ v3.0 ìœˆë„ìš° ì—°ë™ íŠ¹ì§•</strong><br>
      â€¢ âœ… <strong>ì›ë³¸ ì´ë¯¸ì§€ ì§ì ‘ ë‹¤ìš´ë¡œë“œ:</strong> ë¸Œë¼ìš°ì € ë³€í™˜ ë¬¸ì œ ì™„ì „ í•´ê²°<br>
      â€¢ âœ… <strong>ìœˆë„ìš° ì‚¬ì§„ ì•± í™œìš©:</strong> ê¸°ë³¸ ì•±ìœ¼ë¡œ ì•ˆì „í•œ í˜•ì‹ ë³€í™˜<br>
      â€¢ âœ… <strong>PowerShell ìë™í™”:</strong> ì¼ê´„ ë³€í™˜ ë° ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì œê³µ<br>
      â€¢ âœ… <strong>ë‹¤ìš´ë¡œë“œ ë§¤ë‹ˆì € ì§€ì›:</strong> IDM, FDM ë“±ê³¼ ì™„ë²½ í˜¸í™˜<br>
      â€¢ âœ… <strong>100% ì„±ê³µë¥ :</strong> ì›ë³¸ ë‹¤ìš´ë¡œë“œë¡œ ì‹¤íŒ¨ ì—†ìŒ ë³´ì¥<br>
      â€¢ ğŸ’¡ <strong>ì¶”ì²œ:</strong> ì›ë³¸ ë‹¤ìš´ë¡œë“œ â†’ ìœˆë„ìš° ì‚¬ì§„ ì•±ì—ì„œ ì¼ê´„ ë³€í™˜!
    </p>
  </footer>

  <script>
    // ì„¤ì • ê´€ë¦¬ í´ë˜ìŠ¤
    class Config {
      static PROXY_URLS = [
        'https://api.allorigins.win/raw?url=',
        'https://corsproxy.io/?',
        'https://cors-anywhere.herokuapp.com/'
      ];
      static FETCH_TIMEOUT = 30000;
      static MAX_CONCURRENT_DOWNLOADS = 3;
    }

    // ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤
    class Utils {
      static sanitizeFilename(filename) {
        return filename.replace(/[\\/:*?"<>|]/g, '').trim();
      }

      static formatDate() {
        return new Date().toISOString().split('T')[0];
      }

      static async fetchWithTimeout(url, options = {}, timeout = Config.FETCH_TIMEOUT) {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), timeout);
        
        try {
          const response = await fetch(url, {
            ...options,
            signal: controller.signal
          });
          clearTimeout(id);
          return response;
        } catch (error) {
          clearTimeout(id);
          if (error.name === 'AbortError') {
            throw new Error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼');
          }
          throw error;
        }
      }
    }

    // UI ê´€ë¦¬ í´ë˜ìŠ¤
    class UIManager {
      constructor() {
        this.messageArea = document.getElementById('message-area');
        this.loader = document.getElementById('loader');
        this.statsContainer = document.getElementById('stats-container');
        this.bulkActions = document.getElementById('bulk-actions');
        this.progressContainer = document.getElementById('progress-container');
        this.progressFill = document.getElementById('progress-fill');
        this.scriptSection = document.getElementById('script-section');
        this.scriptOutput = document.getElementById('script-output');
      }

      showMessage(message, type = 'info') {
        this.messageArea.textContent = message;
        this.messageArea.className = `message-${type}`;
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      clearMessage() {
        this.messageArea.textContent = '';
        this.messageArea.className = '';
      }

      showLoader() {
        this.loader.style.display = 'block';
      }

      hideLoader() {
        this.loader.style.display = 'none';
      }

      updateStats(totalBooks, categories, downloadReady) {
        document.getElementById('total-books').textContent = totalBooks;
        document.getElementById('unique-categories').textContent = categories;
        document.getElementById('download-ready').textContent = downloadReady;
        this.statsContainer.style.display = 'block';
      }

      showBulkActions() {
        this.bulkActions.style.display = 'block';
      }

      updateProgress(current, total, text = null) {
        const percentage = Math.round((current / total) * 100);
        this.progressFill.style.width = `${percentage}%`;
        this.progressFill.textContent = text || `${percentage}%`;
        this.progressContainer.style.display = 'block';
      }

      hideProgress() {
        this.progressContainer.style.display = 'none';
      }

      showScript(script, title = 'ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸') {
        this.scriptOutput.textContent = script;
        this.scriptSection.style.display = 'block';
        this.scriptSection.scrollIntoView({ behavior: 'smooth' });
      }

      hideScript() {
        this.scriptSection.style.display = 'none';
      }
    }

    // ë„ì„œ ë°ì´í„° ê´€ë¦¬ í´ë˜ìŠ¤
    class BookDataManager {
      constructor() {
        this.books = [];
      }

      addBook(bookData) {
        this.books.push(bookData);
      }

      clearBooks() {
        this.books = [];
      }

      getUniqueCategories() {
        return [...new Set(this.books.map(book => book.category))].length;
      }

      getDownloadReadyCount() {
        return this.books.filter(book => book.imgUrl && !book.imgUrl.includes('placehold.co')).length;
      }

      exportToCSV() {
        const headers = ['ë²ˆí˜¸', 'ë¶„ë¥˜', 'ì œëª©', 'URL', 'ì´ë¯¸ì§€URL'];
        const rows = this.books.map((book, index) => [
          index + 1,
          book.category,
          book.title,
          book.linkUrl,
          book.imgUrl
        ]);

        const csvContent = [
          headers.join(','),
          ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
        ].join('\n');

        const BOM = '\uFEFF';
        return BOM + csvContent;
      }

      exportToJSON() {
        return JSON.stringify(this.books, null, 2);
      }

      getAllTitles() {
        return this.books.map(book => `[${book.category}] ${book.title}`).join('\n');
      }

      generatePowerShellScript() {
        const script = `# ë„ì„œ ì´ë¯¸ì§€ ì¼ê´„ ë‹¤ìš´ë¡œë“œ ë° ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸
# ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
# ì‚¬ìš©ë²•: PowerShellì—ì„œ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
$workDir = "$env:USERPROFILE\\Downloads\\ì•„ì¹¨ë…ì„œ_ì´ë¯¸ì§€_${Utils.formatDate()}"
New-Item -ItemType Directory -Force -Path $workDir
Set-Location $workDir

Write-Host "=== ë„ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹œì‘ ===" -ForegroundColor Green
Write-Host "ì‘ì—… ë””ë ‰í† ë¦¬: $workDir" -ForegroundColor Yellow

# ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
function Download-BookImage {
    param($url, $filename)
    try {
        $webClient = New-Object System.Net.WebClient
        $webClient.Headers.Add("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
        $webClient.DownloadFile($url, $filename)
        Write-Host "âœ“ $filename ë‹¤ìš´ë¡œë“œ ì™„ë£Œ" -ForegroundColor Green
        return $true
    }
    catch {
        Write-Host "âœ— $filename ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: $($_.Exception.Message)" -ForegroundColor Red
        return $false
    }
}

# ì´ë¯¸ì§€ ë³€í™˜ í•¨ìˆ˜ (Windows API ì‚¬ìš©)
function Convert-ToJpeg {
    param($inputPath, $outputPath)
    try {
        Add-Type -AssemblyName System.Drawing
        $image = [System.Drawing.Image]::FromFile($inputPath)
        $jpegCodec = [System.Drawing.Imaging.ImageCodecInfo]::GetImageEncoders() | Where-Object { $_.MimeType -eq "image/jpeg" }
        $encoderParams = New-Object System.Drawing.Imaging.EncoderParameters(1)
        $encoderParams.Param[0] = New-Object System.Drawing.Imaging.EncoderParameter([System.Drawing.Imaging.Encoder]::Quality, [long]85)
        $image.Save($outputPath, $jpegCodec, $encoderParams)
        $image.Dispose()
        Write-Host "âœ“ $outputPath ë³€í™˜ ì™„ë£Œ" -ForegroundColor Cyan
        return $true
    }
    catch {
        Write-Host "âœ— ë³€í™˜ ì‹¤íŒ¨: $($_.Exception.Message)" -ForegroundColor Red
        return $false
    }
}

# ë„ì„œë³„ ë‹¤ìš´ë¡œë“œ ë° ë³€í™˜
$successCount = 0
$totalCount = ${this.books.length}

${this.books.map((book, index) => {
  const safeCategory = Utils.sanitizeFilename(book.category);
  const safeTitle = Utils.sanitizeFilename(book.title);
  const filename = `${String(index + 1).padStart(3, '0')}_[${safeCategory}]_${safeTitle}`;
  
  return `
# ${index + 1}. ${book.title}
$url${index + 1} = "${book.imgUrl}"
$originalFile${index + 1} = "${filename}.ì›ë³¸"
$jpegFile${index + 1} = "${filename}.jpg"

Write-Host "[$((${index + 1}))]/${totalCount} ${book.title}" -ForegroundColor Yellow
if (Download-BookImage $url${index + 1} $originalFile${index + 1}) {
    if (Convert-ToJpeg $originalFile${index + 1} $jpegFile${index + 1}) {
        Remove-Item $originalFile${index + 1} -Force
        $successCount++
    }
}`;
}).join('\n')}

Write-Host "=== ì‘ì—… ì™„ë£Œ ===" -ForegroundColor Green
Write-Host "ì„±ê³µ: $successCount / $totalCount" -ForegroundColor Green
Write-Host "ì €ì¥ ìœ„ì¹˜: $workDir" -ForegroundColor Yellow
Write-Host "ìœˆë„ìš° íƒìƒ‰ê¸°ì—ì„œ í´ë”ë¥¼ ì—´ë ¤ë©´ 'explorer .' ì„ ì…ë ¥í•˜ì„¸ìš”" -ForegroundColor Cyan

# ìë™ìœ¼ë¡œ íƒìƒ‰ê¸° ì—´ê¸°
explorer .`;

        return script;
      }

      generateBatchScript() {
        const script = `@echo off
chcp 65001 > nul
title ë„ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë° ë³€í™˜

echo =================================
echo ë„ì„œ ì´ë¯¸ì§€ ì¼ê´„ ë‹¤ìš´ë¡œë“œ ë„êµ¬
echo ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
echo =================================

set "WORK_DIR=%USERPROFILE%\\Downloads\\ì•„ì¹¨ë…ì„œ_ì´ë¯¸ì§€_${Utils.formatDate()}"
if not exist "%WORK_DIR%" mkdir "%WORK_DIR%"
cd /d "%WORK_DIR%"

echo ì‘ì—… ë””ë ‰í† ë¦¬: %WORK_DIR%
echo.

set SUCCESS_COUNT=0
set TOTAL_COUNT=${this.books.length}

${this.books.map((book, index) => {
  const safeCategory = Utils.sanitizeFilename(book.category);
  const safeTitle = Utils.sanitizeFilename(book.title);
  const filename = `${String(index + 1).padStart(3, '0')}_[${safeCategory}]_${safeTitle}`;
  
  return `
echo [${index + 1}/${this.books.length}] ${book.title}
curl -L -o "${filename}.jpg" "${book.imgUrl}"
if %errorlevel% equ 0 (
    echo âœ“ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ
    set /a SUCCESS_COUNT+=1
) else (
    echo âœ— ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨
)`;
}).join('\n')}

echo.
echo =================================
echo ì‘ì—… ì™„ë£Œ: %SUCCESS_COUNT%/%TOTAL_COUNT%
echo ì €ì¥ ìœ„ì¹˜: %WORK_DIR%
echo =================================
echo íƒìƒ‰ê¸°ë¥¼ ì—´ë ¤ë©´ ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ì„¸ìš”...
pause > nul
explorer .`;

        return script;
      }

      generateUrlList() {
        return this.books.map((book, index) => {
          const safeCategory = Utils.sanitizeFilename(book.category);
          const safeTitle = Utils.sanitizeFilename(book.title);
          const filename = `${String(index + 1).padStart(3, '0')}_[${safeCategory}]_${safeTitle}.jpg`;
          return `${book.imgUrl}\n  out=${filename}`;
        }).join('\n\n');
      }
    }

    // ìœˆë„ìš° ì—°ë™ ì²˜ë¦¬ í´ë˜ìŠ¤
    class WindowsIntegration {
      static async downloadOriginalImage(imgUrl, filename, button) {
        button.disabled = true;
        const originalText = button.textContent;
        button.textContent = 'ë‹¤ìš´ë¡œë“œ ì¤‘...';

        try {
          // í”„ë¡ì‹œ ì—†ì´ ì§ì ‘ ì‹œë„
          let response;
          try {
            response = await Utils.fetchWithTimeout(imgUrl);
          } catch (directError) {
            // ì§ì ‘ ì‹¤íŒ¨ì‹œ í”„ë¡ì‹œ ì‚¬ìš©
            for (const proxyUrl of Config.PROXY_URLS) {
              try {
                response = await Utils.fetchWithTimeout(proxyUrl + encodeURIComponent(imgUrl));
                if (response.ok) break;
              } catch (proxyError) {
                continue;
              }
            }
          }

          if (!response || !response.ok) {
            throw new Error('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
          }

          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          button.textContent = 'âœ… ì™„ë£Œ';
          setTimeout(() => {
            button.textContent = originalText;
          }, 2000);

        } catch (error) {
          console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
          button.textContent = 'âŒ ì‹¤íŒ¨';
          
          // Fallback: ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
          if (confirm('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì—´ê¹Œìš”?')) {
            window.open(imgUrl, '_blank', 'noopener,noreferrer');
          }
          
          setTimeout(() => {
            button.textContent = originalText;
          }, 2000);
        } finally {
          button.disabled = false;
        }
      }

      static showPhotoAppGuide() {
        const guide = `ğŸ“– ìœˆë„ìš° ì‚¬ì§„ ì•± í™œìš© ê°€ì´ë“œ

1ï¸âƒ£ ì›ë³¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
   â€¢ ê° ë„ì„œ ì¹´ë“œì—ì„œ "ğŸ“¥ ì›ë³¸ ë‹¤ìš´ë¡œë“œ" í´ë¦­
   â€¢ ë˜ëŠ” "ğŸ“¥ ì›ë³¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ" ì¼ê´„ ì‹¤í–‰

2ï¸âƒ£ ìœˆë„ìš° ì‚¬ì§„ ì•±ì—ì„œ ì—´ê¸°
   â€¢ ë‹¤ìš´ë¡œë“œëœ ì´ë¯¸ì§€ ìš°í´ë¦­
   â€¢ "í”„ë¡œê·¸ë¨ìœ¼ë¡œ ì—´ê¸°" â†’ "ì‚¬ì§„" ì„ íƒ

3ï¸âƒ£ í˜•ì‹ ë³€í™˜í•˜ê¸°
   â€¢ ì‚¬ì§„ ì•±ì—ì„œ "..." ë©”ë‰´ í´ë¦­
   â€¢ "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" ì„ íƒ
   â€¢ ì›í•˜ëŠ” í˜•ì‹(JPG/PNG) ì„ íƒ í›„ ì €ì¥

4ï¸âƒ£ ì¼ê´„ ë³€í™˜ (ê³ ê¸‰)
   â€¢ PowerShell ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë²„íŠ¼ í´ë¦­
   â€¢ ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ .ps1 íŒŒì¼ë¡œ ì €ì¥
   â€¢ PowerShellì—ì„œ ì‹¤í–‰í•˜ì—¬ ìë™ ì¼ê´„ ë³€í™˜

ğŸ’¡ íŒ: ì‚¬ì§„ ì•±ì˜ "í¸ì§‘" ê¸°ëŠ¥ìœ¼ë¡œ í¬ê¸° ì¡°ì ˆ, ìë¥´ê¸°ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤!`;

        alert(guide);
      }
    }

    // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤
    class BookExtractor {
      constructor() {
        this.ui = new UIManager();
        this.dataManager = new BookDataManager();
        this.initializeEventListeners();
      }

      initializeEventListeners() {
        document.getElementById('fetch-btn').addEventListener('click', () => this.extractBooks());
        document.getElementById('clear-btn').addEventListener('click', () => this.clearAll());
        
        // ìœˆë„ìš° ì—°ë™ ë²„íŠ¼ë“¤
        document.getElementById('photo-app-guide').addEventListener('click', () => {
          WindowsIntegration.showPhotoAppGuide();
        });
        
        document.getElementById('generate-powershell').addEventListener('click', () => {
          this.generatePowerShellScript();
        });
        
        document.getElementById('generate-url-list').addEventListener('click', () => {
          this.generateUrlList();
        });

        // ì¼ê´„ ì‘ì—… ë²„íŠ¼ë“¤
        document.getElementById('copy-all-titles').addEventListener('click', () => this.copyAllTitles());
        document.getElementById('export-csv').addEventListener('click', () => this.exportCSV());
        document.getElementById('export-json').addEventListener('click', () => this.exportJSON());
        document.getElementById('download-all-original').addEventListener('click', () => this.downloadAllOriginal());
        document.getElementById('create-batch-script').addEventListener('click', () => this.createBatchScript());

        // ìŠ¤í¬ë¦½íŠ¸ ê´€ë ¨ ë²„íŠ¼ë“¤
        document.getElementById('copy-script').addEventListener('click', () => this.copyScript());
        document.getElementById('download-script').addEventListener('click', () => this.downloadScript());
        
        // URL ì…ë ¥ ì‹œ Enter í‚¤ ì²˜ë¦¬
        document.getElementById('url-input').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            this.extractBooks();
          }
        });
      }

      async extractBooks() {
        const urlInput = document.getElementById('url-input');
        const rawUrl = urlInput.value.trim();
        
        if (!rawUrl) {
          this.ui.showMessage('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
          return;
        }

        try {
          new URL(rawUrl);
        } catch (_) {
          this.ui.showMessage('ìœ íš¨í•˜ì§€ ì•Šì€ URLì…ë‹ˆë‹¤', 'error');
          return;
        }

        const fetchBtn = document.getElementById('fetch-btn');
        fetchBtn.disabled = true;
        fetchBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
        
        this.clearBookList();
        this.ui.showLoader();
        this.ui.showMessage('í˜ì´ì§€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');

        try {
          let response;
          let lastError;

          // ë‹¤ì¤‘ í”„ë¡ì‹œ ì‹œë„
          for (const proxyUrl of Config.PROXY_URLS) {
            try {
              response = await Utils.fetchWithTimeout(proxyUrl + encodeURIComponent(rawUrl));
              if (response.ok) break;
            } catch (error) {
              lastError = error;
              continue;
            }
          }

          if (!response || !response.ok) {
            throw lastError || new Error('ëª¨ë“  í”„ë¡ì‹œì—ì„œ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨');
          }

          const html = await response.text();
          const doc = new DOMParser().parseFromString(html, 'text/html');
          
          const table = doc.querySelector('table[id="00"]');
          if (!table) {
            throw new Error('ë„ì„œ ëª©ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          }

          const bookCells = Array.from(table.getElementsByTagName('td'))
            .filter(td => td.rowSpan === 3);
          
          if (bookCells.length === 0) {
            this.ui.showMessage('ë„ì„œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤', 'info');
            return;
          }

          this.ui.showMessage(`${bookCells.length}ê°œì˜ ë„ì„œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤`, 'success');
          
          let successCount = 0;
          for (let i = 0; i < bookCells.length; i++) {
            try {
              await this.processBook(bookCells[i], rawUrl, i + 1);
              successCount++;
            } catch (error) {
              console.error(`ë„ì„œ ${i + 1} ì²˜ë¦¬ ì˜¤ë¥˜:`, error);
            }
          }

          // í†µê³„ ì—…ë°ì´íŠ¸
          this.ui.updateStats(
            this.dataManager.books.length,
            this.dataManager.getUniqueCategories(),
            this.dataManager.getDownloadReadyCount()
          );
          
          this.ui.showBulkActions();
          this.ui.showMessage(`ì²˜ë¦¬ ì™„ë£Œ: ${successCount}/${bookCells.length}ê°œ ì„±ê³µ`, 'success');

        } catch (error) {
          this.ui.showMessage(`ì˜¤ë¥˜: ${error.message}`, 'error');
        } finally {
          this.ui.hideLoader();
          fetchBtn.disabled = false;
          fetchBtn.textContent = 'ğŸ” ì¶”ì¶œ ì‹œì‘';
        }
      }

      async processBook(td, baseUrl, index) {
        const linkElement = td.querySelector('a');
        const imgElement = td.querySelector('img');
        
        if (!linkElement || !imgElement) {
          throw new Error('í•„ìˆ˜ ìš”ì†Œ ëˆ„ë½');
        }

        const linkUrl = new URL(linkElement.getAttribute('href') || '#', baseUrl).href;
        const imgUrl = new URL(
          imgElement.getAttribute('src') || 'https://placehold.co/100x150',
          baseUrl
        ).href;

        const infoTd = td.nextElementSibling;
        let title = 'ì œëª© ì—†ìŒ';
        let category = 'ë¶„ë¥˜ ì—†ìŒ';

        if (infoTd) {
          const titleElement = infoTd.querySelector('h3 a');
          const categoryElement = infoTd.querySelector('table font');
          
          if (titleElement) title = titleElement.textContent.trim();
          if (categoryElement) category = categoryElement.textContent.trim();
        }

        // ë°ì´í„° ì €ì¥
        this.dataManager.addBook({
          index,
          category,
          title,
          linkUrl,
          imgUrl
        });

        // UI ìƒì„±
        this.createBookElement({
          index,
          category,
          title,
          linkUrl,
          imgUrl
        });
      }

      createBookElement(bookData) {
        const { index, category, title, linkUrl, imgUrl } = bookData;
        
        const bookDiv = document.createElement('div');
        bookDiv.className = 'book';
        
        const safeCategory = Utils.sanitizeFilename(category);
        const safeTitle = Utils.sanitizeFilename(title);
        const filename = `${String(index).padStart(3, '0')}_[${safeCategory}]_${safeTitle}`;
        const titleToCopy = `[${category}] ${title}`;

        bookDiv.innerHTML = `
          <span class="book-number">#${index}</span>
          <img class="cover" src="${imgUrl}" alt="${title} í‘œì§€" 
               onerror="this.src='https://placehold.co/100x150/eee/ccc?text=No+Image'">
          <div class="info">
            <span class="category">${category}</span>
            <p class="title">
              <a href="${linkUrl}" target="_blank" rel="noopener noreferrer">${title}</a>
            </p>
            <div class="actions">
              <button class="download-btn">ğŸ“¥ ì›ë³¸ ë‹¤ìš´ë¡œë“œ</button>
              <button class="copy-title-btn">ğŸ“‹ ì œëª©</button>
              <button class="copy-url-btn">ğŸ”— URL</button>
            </div>
          </div>
        `;

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const downloadBtn = bookDiv.querySelector('.download-btn');
        const copyTitleBtn = bookDiv.querySelector('.copy-title-btn');
        const copyUrlBtn = bookDiv.querySelector('.copy-url-btn');

        if (imgUrl && !imgUrl.includes('placehold.co')) {
          downloadBtn.addEventListener('click', () => {
            WindowsIntegration.downloadOriginalImage(imgUrl, filename + '.jpg', downloadBtn);
          });
        } else {
          downloadBtn.disabled = true;
          downloadBtn.textContent = 'âŒ ë¶ˆê°€';
        }

        copyTitleBtn.addEventListener('click', async () => {
          await this.copyToClipboard(titleToCopy, copyTitleBtn);
        });

        copyUrlBtn.addEventListener('click', async () => {
          await this.copyToClipboard(linkUrl, copyUrlBtn);
        });

        document.getElementById('book-list').appendChild(bookDiv);
      }

      async copyToClipboard(text, button) {
        const originalText = button.textContent;
        button.disabled = true;
        
        try {
          await navigator.clipboard.writeText(text);
          button.textContent = 'âœ“ ë³µì‚¬ë¨';
          setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
          }, 1500);
        } catch (err) {
          button.textContent = 'âŒ ì‹¤íŒ¨';
          setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
          }, 1500);
        }
      }

      async copyAllTitles() {
        const titles = this.dataManager.getAllTitles();
        try {
          await navigator.clipboard.writeText(titles);
          this.ui.showMessage('ì „ì²´ ì œëª©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        } catch (err) {
          this.ui.showMessage('ë³µì‚¬ ì‹¤íŒ¨', 'error');
        }
      }

      generatePowerShellScript() {
        if (this.dataManager.books.length === 0) {
          this.ui.showMessage('ë¨¼ì € ë„ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”', 'error');
          return;
        }

        const script = this.dataManager.generatePowerShellScript();
        this.ui.showScript(script);
        this.ui.showMessage('PowerShell ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      }

      generateUrlList() {
        if (this.dataManager.books.length === 0) {
          this.ui.showMessage('ë¨¼ì € ë„ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”', 'error');
          return;
        }

        const urlList = this.dataManager.generateUrlList();
        this.ui.showScript(urlList);
        this.ui.showMessage('ë‹¤ìš´ë¡œë“œ ë§¤ë‹ˆì €ìš© URL ë¦¬ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      }

      async downloadAllOriginal() {
        const books = this.dataManager.books.filter(book => 
          book.imgUrl && !book.imgUrl.includes('placehold.co')
        );
        
        if (books.length === 0) {
          this.ui.showMessage('ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
          return;
        }

        const button = document.getElementById('download-all-original');
        button.disabled = true;
        button.textContent = 'ì¼ê´„ ë‹¤ìš´ë¡œë“œ ì¤‘...';

        let completed = 0;
        const total = books.length;

        try {
          for (const book of books) {
            const safeCategory = Utils.sanitizeFilename(book.category);
            const safeTitle = Utils.sanitizeFilename(book.title);
            const filename = `${String(book.index).padStart(3, '0')}_[${safeCategory}]_${safeTitle}.jpg`;
            
            const virtualButton = { disabled: false, textContent: '' };
            await WindowsIntegration.downloadOriginalImage(book.imgUrl, filename, virtualButton);
            
            completed++;
            this.ui.updateProgress(completed, total, `${completed}/${total} ì™„ë£Œ`);
            
            // ë„ˆë¬´ ë¹ ë¥¸ ìš”ì²­ ë°©ì§€
            await new Promise(resolve => setTimeout(resolve, 500));
          }

          this.ui.showMessage(`ì¼ê´„ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${completed}ê°œ íŒŒì¼`, 'success');
          
        } catch (error) {
          this.ui.showMessage(`ì¼ê´„ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
        } finally {
          this.ui.hideProgress();
          button.disabled = false;
          button.textContent = 'ğŸ“¥ ì›ë³¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ';
        }
      }

      createBatchScript() {
        if (this.dataManager.books.length === 0) {
          this.ui.showMessage('ë¨¼ì € ë„ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”', 'error');
          return;
        }

        const script = this.dataManager.generateBatchScript();
        this.ui.showScript(script);
        this.ui.showMessage('ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      }

      async copyScript() {
        const script = this.ui.scriptOutput.textContent;
        try {
          await navigator.clipboard.writeText(script);
          this.ui.showMessage('ìŠ¤í¬ë¦½íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        } catch (err) {
          this.ui.showMessage('ë³µì‚¬ ì‹¤íŒ¨', 'error');
        }
      }

      downloadScript() {
        const script = this.ui.scriptOutput.textContent;
        const isPowerShell = script.includes('PowerShell');
        const extension = isPowerShell ? '.ps1' : '.bat';
        const filename = `ë„ì„œì´ë¯¸ì§€_ë‹¤ìš´ë¡œë“œ_ìŠ¤í¬ë¦½íŠ¸_${Utils.formatDate()}${extension}`;
        
        this.downloadFile(script, filename, 'text/plain;charset=utf-8');
        this.ui.showMessage(`${filename} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
      }

      exportCSV() {
        const csv = this.dataManager.exportToCSV();
        this.downloadFile(csv, `ë„ì„œëª©ë¡_${Utils.formatDate()}.csv`, 'text/csv;charset=utf-8');
        this.ui.showMessage('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      }

      exportJSON() {
        const json = this.dataManager.exportToJSON();
        this.downloadFile(json, `ë„ì„œëª©ë¡_${Utils.formatDate()}.json`, 'application/json');
        this.ui.showMessage('JSON íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
      }

      downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      clearBookList() {
        document.getElementById('book-list').innerHTML = '';
        this.dataManager.clearBooks();
      }

      clearAll() {
        this.clearBookList();
        document.getElementById('url-input').value = '';
        this.ui.clearMessage();
        this.ui.statsContainer.style.display = 'none';
        this.ui.bulkActions.style.display = 'none';
        this.ui.hideScript();
        this.ui.showMessage('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
      }
    }

    // ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new BookExtractor();
      console.log('ğŸªŸ ìœˆë„ìš° ì—°ë™ ì•„ì¹¨ë…ì„œ ë„ì„œ ì •ë³´ ì¶”ì¶œê¸° v3.0 ì‹œì‘ë¨');
    });
  </script>
</body>
</html>